<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="amgn.amu.mapper.UserMfaBackupCodeMapper">
    <insert id="insertBatch">
        INSERT INTO user_mfa_backup_codes (USER_ID, CODE_HASH, USED, CREATED_AT)
        VALUES
        <foreach collection="codes" item="c" separator=",">
            (#{userId}, #{c.codeHash}, 0, NOW())
        </foreach>
    </insert>

    <select id="listActive" resultType="amgn.amu.entity.UserMfaBackupCode">
        SELECT *
        FROM user_mfa_backup_codes
        WHERE USER_ID = #{userId}
        AND USED = 0
        ORDER BY BACKUP_CODE_ID ASC
    </select>

    <update id="markUsed">
        UPDATE user_mfa_backup_codes
        SET USED = 1
        WHERE BACKUP_CODE_ID = #{backupCodeId}
    </update>

    <delete id="revokeAll">
        DELETE FROM user_mfa_backup_codes
        WHERE USER_ID = #{userId}
    </delete>
</mapper>